/**
 * @copyright 2025 NoxFly
 * @license MIT
 * @author NoxFly
 */
var Pt=Object.defineProperty;var ee=(o,t,e)=>t in o?Pt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var n=(o,t)=>Pt(o,"name",{value:t,configurable:!0});var i=(o,t,e)=>ee(o,typeof t!="symbol"?t+"":t,e);import"reflect-metadata";var Z=class Z extends Error{constructor(e,r){let s;typeof e=="number"?s=e:typeof e=="string"&&(r=e);super(r??"");i(this,"status",0);s!==void 0&&(this.status=s),this.name=this.constructor.name.replace(/([A-Z])/g," $1")}};n(Z,"ResponseException");var f=Z,H=class H extends f{constructor(){super(...arguments);i(this,"status",400)}};n(H,"BadRequestException");var jt=H,Q=class Q extends f{constructor(){super(...arguments);i(this,"status",401)}};n(Q,"UnauthorizedException");var j=Q,X=class X extends f{constructor(){super(...arguments);i(this,"status",402)}};n(X,"PaymentRequiredException");var Ct=X,V=class V extends f{constructor(){super(...arguments);i(this,"status",403)}};n(V,"ForbiddenException");var Tt=V,_=class _ extends f{constructor(){super(...arguments);i(this,"status",404)}};n(_,"NotFoundException");var C=_,q=class q extends f{constructor(){super(...arguments);i(this,"status",405)}};n(q,"MethodNotAllowedException");var T=q,tt=class tt extends f{constructor(){super(...arguments);i(this,"status",406)}};n(tt,"NotAcceptableException");var It=tt,et=class et extends f{constructor(){super(...arguments);i(this,"status",408)}};n(et,"RequestTimeoutException");var Ot=et,rt=class rt extends f{constructor(){super(...arguments);i(this,"status",409)}};n(rt,"ConflictException");var Dt=rt,ot=class ot extends f{constructor(){super(...arguments);i(this,"status",426)}};n(ot,"UpgradeRequiredException");var Gt=ot,nt=class nt extends f{constructor(){super(...arguments);i(this,"status",429)}};n(nt,"TooManyRequestsException");var St=nt,st=class st extends f{constructor(){super(...arguments);i(this,"status",500)}};n(st,"InternalServerException");var I=st,at=class at extends f{constructor(){super(...arguments);i(this,"status",501)}};n(at,"NotImplementedException");var Nt=at,it=class it extends f{constructor(){super(...arguments);i(this,"status",502)}};n(it,"BadGatewayException");var zt=it,lt=class lt extends f{constructor(){super(...arguments);i(this,"status",503)}};n(lt,"ServiceUnavailableException");var Ft=lt,ct=class ct extends f{constructor(){super(...arguments);i(this,"status",504)}};n(ct,"GatewayTimeoutException");var Yt=ct,dt=class dt extends f{constructor(){super(...arguments);i(this,"status",505)}};n(dt,"HttpVersionNotSupportedException");var Et=dt,ut=class ut extends f{constructor(){super(...arguments);i(this,"status",506)}};n(ut,"VariantAlsoNegotiatesException");var Lt=ut,ft=class ft extends f{constructor(){super(...arguments);i(this,"status",507)}};n(ft,"InsufficientStorageException");var Wt=ft,mt=class mt extends f{constructor(){super(...arguments);i(this,"status",508)}};n(mt,"LoopDetectedException");var Kt=mt,ht=class ht extends f{constructor(){super(...arguments);i(this,"status",510)}};n(ht,"NotExtendedException");var kt=ht,pt=class pt extends f{constructor(){super(...arguments);i(this,"status",511)}};n(pt,"NetworkAuthenticationRequiredException");var Jt=pt,gt=class gt extends f{constructor(){super(...arguments);i(this,"status",599)}};n(gt,"NetworkConnectTimeoutException");var Ut=gt;var O=class O{constructor(t=null){i(this,"name");i(this,"bindings",new Map);i(this,"singletons",new Map);i(this,"scoped",new Map);this.name=t}createScope(){let t=new O;return t.bindings=this.bindings,t.singletons=this.singletons,t}resolve(t){let e=this.bindings.get(t);if(!e)throw new I(`Failed to resolve a dependency injection : No binding for type ${t.name}.
Did you forget to use @Injectable() decorator ?`);switch(e.lifetime){case"transient":return this.instantiate(e.implementation);case"scope":{if(this.scoped.has(t))return this.scoped.get(t);let r=this.instantiate(e.implementation);return this.scoped.set(t,r),r}case"singleton":return e.instance===void 0&&this.name==="root"&&(e.instance=this.instantiate(e.implementation),this.singletons.set(t,e.instance)),e.instance}}instantiate(t){let r=(Reflect.getMetadata("design:paramtypes",t)||[]).map(s=>this.resolve(s));return new t(...r)}};n(O,"AppInjector");var wt=O;function D(o){return h.resolve(o)}n(D,"inject");var h=new wt("root");import"reflect-metadata";function re(){let o=new Date;return`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}:${o.getSeconds().toString().padStart(2,"0")}`}n(re,"getPrettyTimestamp");function b(o,t,e){let r=re(),s=" ".repeat(10-t.length);return`${e}[APP] ${process.pid} - ${d.colors.initial}${r}${s}${e}${t.toUpperCase()}${d.colors.initial} ${d.colors.yellow}[${o}]${d.colors.initial}`}n(b,"getLogPrefix");function oe(o,t){return JSON.stringify(t,null,2).split(`
`).map((s,a)=>a===0?`${d.colors.darkGrey}${s}`:`${o} ${d.colors.grey}${s}`).join(`
`)+d.colors.initial}n(oe,"formatObject");function R(o,t,e){return t.map(r=>typeof r=="string"?`${e}${r}${d.colors.initial}`:typeof r=="object"?oe(o,r):r)}n(R,"formattedArgs");function A(){return(new Error().stack?.split(`
`)??[])[3]?.trim().match(/at (.+?)(?:\..+)? .+$/)?.[1]?.replace("Object","")||"App"}n(A,"getCallee");function y(o){return Bt[o]>=Bt[Zt]}n(y,"canLog");var Zt="log",Bt={debug:0,log:1,info:2,warn:3,error:4};(function(o){function t(c){Zt=c}n(t,"setLogLevel"),o.setLogLevel=t;function e(...c){if(!y("log"))return;let m=A(),u=b(m,"log",o.colors.green);console.log(u,...R(u,c,o.colors.green))}n(e,"log"),o.log=e;function r(...c){if(!y("info"))return;let m=A(),u=b(m,"info",o.colors.blue);console.info(u,...R(u,c,o.colors.blue))}n(r,"info"),o.info=r;function s(...c){if(!y("warn"))return;let m=A(),u=b(m,"warn",o.colors.brown);console.warn(u,...R(u,c,o.colors.brown))}n(s,"warn"),o.warn=s;function a(...c){if(!y("error"))return;let m=A(),u=b(m,"error",o.colors.red);console.error(u,...R(u,c,o.colors.red))}n(a,"error"),o.error=a;function l(...c){if(!y("debug"))return;let m=A(),u=b(m,"debug",o.colors.purple);console.debug(u,...R(u,c,o.colors.purple))}n(l,"debug"),o.debug=l,o.colors={black:"\x1B[0;30m",grey:"\x1B[0;37m",red:"\x1B[0;31m",green:"\x1B[0;32m",brown:"\x1B[0;33m",blue:"\x1B[0;34m",purple:"\x1B[0;35m",darkGrey:"\x1B[1;30m",lightRed:"\x1B[1;31m",lightGreen:"\x1B[1;32m",yellow:"\x1B[1;33m",lightBlue:"\x1B[1;34m",magenta:"\x1B[1;35m",cyan:"\x1B[1;36m",white:"\x1B[1;37m",initial:"\x1B[0m"}})(d||(d={}));var d;function be(...o){return(t,e)=>{let r;if(e?r=`${t.constructor.name}.${e}`:r=`${t.name}`,G.has(r))throw new Error(`Guard(s) already registered for ${r}`);d.debug(`Registering guard(s) for ${r}: ${o.map(s=>s.name).join(", ")}`),G.set(r,o)}}n(be,"Authorize");function S(o){let t=`${o}`;return G.get(t)??[]}n(S,"getGuardForController");function N(o,t){let e=`${o}.${t}`;return G.get(e)??[]}n(N,"getGuardForControllerAction");var G=new Map;function v(o){return t=>(e,r)=>{let s=Reflect.getMetadata(xt,e.constructor)||[],a={method:o,path:t.trim().replace(/^\/|\/$/g,""),handler:r,guards:N(e.constructor.__controllerName,r)};s.push(a),Reflect.defineMetadata(xt,s,e.constructor)}}n(v,"createRouteDecorator");function z(o){return Reflect.getMetadata(xt,o)||[]}n(z,"getRouteMetadata");var ve=v("GET"),Pe=v("POST"),je=v("PUT"),Ce=v("PATCH"),Te=v("DELETE"),xt=Symbol("ROUTE_METADATA_KEY");function Se(o){return t=>{let e=n((a,l)=>{if(a){for(let c of a)if(!Reflect.getMetadata($t,c))throw new Error(`Class ${c.name} in ${l} must be decorated with @Module`)}},"checkModule"),r=n(a=>{if(a){for(let l of a)if(!Reflect.getMetadata(Y,l))throw new Error(`Class ${l.name} in providers must be decorated with @Injectable`)}},"checkInjectable"),s=n(a=>{if(a){for(let l of a)if(!Reflect.getMetadata(E,l))throw new Error(`Class ${l.name} in controllers must be decorated with @Controller`)}},"checkController");e(o.imports,"imports"),e(o.exports,"exports"),r(o.providers),s(o.controllers),Reflect.defineMetadata($t,o,t),w("singleton")(t)}}n(Se,"Module");function F(o){return Reflect.getMetadata($t,o)}n(F,"getModuleMetadata");var $t=Symbol("MODULE_METADATA_KEY");var Mt=class Mt{static register(t,e){return d.debug(`Registering ${t.name} as ${e}`),h.bindings.has(t)?h:(h.bindings.set(t,{implementation:t,lifetime:e}),e==="singleton"&&h.resolve(t),F(t)?(d.log(`${t.name} dependencies initialized`),h):W(t)?(h.resolve(g)?.registerController(t),h):z(t)?h:Ht(t)?(d.log(`Registered ${t.name} as ${e}`),h):h)}};n(Mt,"InjectorExplorer");var L=Mt;function w(o="scope"){return t=>{if(typeof t!="function"||!t.prototype)throw new Error(`@Injectable can only be used on classes, not on ${typeof t}`);Reflect.defineMetadata(Y,o,t),L.register(t,o)}}n(w,"Injectable");function Ht(o){return Reflect.getMetadata(Y,o)}n(Ht,"getInjectableMetadata");var Y=Symbol("INJECTABLE_METADATA_KEY");function Ve(o){return t=>{let e={path:o,guards:S(t.name)};Reflect.defineMetadata(E,e,t),w("scope")(t)}}n(Ve,"Controller");function W(o){return Reflect.getMetadata(E,o)}n(W,"getControllerMetadata");var E=Symbol("CONTROLLER_METADATA_KEY");function er(o){return(t,e)=>{let r;if(e?r=`${t.constructor.name}.${e}`:r=`${t.name}`,K.has(r))throw new Error(`Middlewares(s) already registered for ${r}`);d.debug(`Registering middleware(s) for ${r}: ${o.map(s=>s.name).join(", ")}`),K.set(r,o)}}n(er,"UseMiddlewares");function Qt(o){let t=`${o}`;return K.get(t)??[]}n(Qt,"getMiddlewaresForController");function Xt(o,t){let e=`${o}.${t}`;return K.get(e)??[]}n(Xt,"getMiddlewaresForControllerAction");var K=new Map;var x,Vt=(x=class{constructor(t){i(this,"segment");i(this,"children",[]);i(this,"value");i(this,"isParam");i(this,"paramName");this.segment=t,this.isParam=t.startsWith(":"),this.isParam&&(this.paramName=t.slice(1))}matchChild(t){for(let e of this.children)if(e.isParam||t.startsWith(e.segment))return e}findExactChild(t){return this.children.find(e=>e.segment===t)}addChild(t){this.children.push(t)}},n(x,"RadixNode"),x),bt=class bt{constructor(){i(this,"root",new Vt(""))}insert(t,e){let r=this.normalize(t);this.insertRecursive(this.root,r,e)}insertRecursive(t,e,r){if(e.length===0){t.value=r;return}let s=e[0]??"",a=t.children.find(l=>l.isParam===s.startsWith(":")&&(l.isParam||l.segment===s));a||(a=new Vt(s),t.addChild(a)),this.insertRecursive(a,e.slice(1),r)}search(t){let e=this.normalize(t);return this.searchRecursive(this.root,e,{})}searchRecursive(t,e,r){if(e.length===0)return t.value!==void 0?{node:t,params:r}:void 0;let[s,...a]=e;for(let l of t.children)if(l.isParam){let c=l.paramName,m={...r,[c]:s??""};if(a.length===0)return{node:l,params:m};let u=this.searchRecursive(l,a,m);if(u)return u}else if(s===l.segment){if(a.length===0)return{node:l,params:r};let c=this.searchRecursive(l,a,r);if(c)return c}}normalize(t){return["",...t.replace(/^\/+|\/+$/g,"").split("/").filter(Boolean)]}};n(bt,"RadixTree");var k=bt;function ne(o,t,e,r){var s=arguments.length,a=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,t,e,r);else for(var c=o.length-1;c>=0;c--)(l=o[c])&&(a=(s<3?l(a):s>3?l(t,e,a):l(t,e))||a);return s>3&&a&&Object.defineProperty(t,e,a),a}n(ne,"_ts_decorate");var Rt=class Rt{constructor(){i(this,"routes",new k);i(this,"rootMiddlewares",[])}registerController(t){let e=W(t),r=S(t.name),s=Qt(t.name);if(!e)throw new Error(`Missing @Controller decorator on ${t.name}`);let a=z(t);for(let m of a){let u=`${e.path}/${m.path}`.replace(/\/+/g,"/"),p=N(t.name,m.handler),U=Xt(t.name,m.handler),M=new Set([...r,...p]),B=new Set([...s,...U]),P={method:m.method,path:u,controller:t,handler:m.handler,guards:[...M],middlewares:[...B]};this.routes.insert(u+"/"+m.method,P);let qt=P.guards.length>0?"<"+P.guards.map(te=>te.name).join("|")+">":"";d.log(`Mapped {${P.method} /${u}}${qt} route`)}let c=e.guards.length>0?"<"+e.guards.map(m=>m.name).join("|")+">":"";return d.log(`Mapped ${t.name}${c} controller's routes`),this}defineRootMiddleware(t){return d.debug(`Registering root middleware: ${t.name}`),this.rootMiddlewares.push(t),this}async handle(t){d.log(`> Received request: {${t.method} /${t.path}}`);let e=performance.now(),r={requestId:t.id,status:200,body:null,error:void 0};try{let s=this.findRoute(t);if(await this.resolveController(t,r,s),r.status>400)throw new f(r.status,r.error)}catch(s){s instanceof f?(r.status=s.status,r.error=s.message):s instanceof Error?(r.status=500,r.error=s.message||"Internal Server Error"):(r.status=500,r.error="Unknown error occurred")}finally{let s=performance.now(),a=`< ${r.status} ${t.method} /${t.path} ${d.colors.yellow}${Math.round(s-e)}ms${d.colors.initial}`;return r.status<400?d.log(a):r.status<500?d.warn(a):d.error(a),r.error!==void 0&&d.error(r.error),r}}findRoute(t){let e=this.routes.search(t.path);if(e?.node===void 0||e.node.children.length===0)throw new C(`No route matches ${t.method} ${t.path}`);let r=e.node.findExactChild(t.method);if(r?.value===void 0)throw new T(`Method Not Allowed for ${t.method} ${t.path}`);return r.value}async resolveController(t,e,r){let s=t.context.resolve(r.controller);Object.assign(t.params,this.extractParams(t.path,r.path)),await this.runRequestPipeline(t,e,r,s)}async runRequestPipeline(t,e,r,s){let a=[...new Set([...this.rootMiddlewares,...r.middlewares])],l=a.length-1,c=l+r.guards.length,m=-1,u=n(async p=>{if(p<=m)throw new Error("next() called multiple times");if(m=p,p<=l){let M=u.bind(null,p+1);if(await this.runMiddleware(t,e,M,a[p]),e.status>=400)throw new f(e.status,e.error);return}if(p<=c){let M=p-a.length,B=r.guards[M];await this.runGuard(t,B),u(p+1);return}let U=s[r.handler];e.body=await U.call(s,t,e)},"dispatch");await u(0)}async runMiddleware(t,e,r,s){await t.context.resolve(s).invoke(t,e,r)}async runGuard(t,e){if(!await t.context.resolve(e).canActivate(t))throw new j(`Unauthorized for ${t.method} ${t.path}`)}extractParams(t,e){let r=t.split("/"),s=e.split("/"),a={};return s.forEach((l,c)=>{l.startsWith(":")&&(a[l.slice(1)]=r[c]??"")}),a}};n(Rt,"Router");var g=Rt;g=ne([w("singleton")],g);import{app as yt,BrowserWindow as ae,ipcMain as ie,MessageChannelMain as le}from"electron/main";import"reflect-metadata";var At=class At{constructor(t,e,r,s,a){i(this,"event");i(this,"id");i(this,"method");i(this,"path");i(this,"body");i(this,"context",h.createScope());i(this,"params",{});this.event=t,this.id=e,this.method=r,this.path=s,this.body=a,this.path=s.replace(/^\/|\/$/g,"")}};n(At,"Request");var J=At;function se(o,t,e,r){var s=arguments.length,a=s<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(o,t,e,r);else for(var c=o.length-1;c>=0;c--)(l=o[c])&&(a=(s<3?l(a):s>3?l(t,e,a):l(t,e))||a);return s>3&&a&&Object.defineProperty(t,e,a),a}n(se,"_ts_decorate");function _t(o,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(o,t)}n(_t,"_ts_metadata");var vt=class vt{constructor(t){i(this,"router");i(this,"messagePorts",new Map);i(this,"app");this.router=t}async init(){return ie.on("gimme-my-port",this.giveTheRendererAPort.bind(this)),yt.once("activate",this.onAppActivated.bind(this)),yt.once("window-all-closed",this.onAllWindowsClosed.bind(this)),console.log(""),this}giveTheRendererAPort(t){let e=t.sender.id;this.messagePorts.has(e)&&this.shutdownChannel(e);let r=new le;this.messagePorts.set(e,r),r.port1.on("message",this.onRendererMessage.bind(this)),r.port1.start(),t.sender.postMessage("port",{senderId:e},[r.port2])}async onRendererMessage(t){let{senderId:e,requestId:r,path:s,method:a,body:l}=t.data,c=this.messagePorts.get(e);if(!c){d.error(`No message channel found for sender ID: ${e}`);return}try{let m=new J(t,r,a,s,l),u=await this.router.handle(m);c.port1.postMessage(u)}catch(m){let u={requestId:r,status:500,body:null,error:m.message||"Internal Server Error"};c.port1.postMessage(u)}}onAppActivated(){process.platform==="darwin"&&ae.getAllWindows().length===0&&this.app?.onActivated()}shutdownChannel(t){let e=this.messagePorts.get(t);if(!e){d.warn(`No message channel found for sender ID: ${t}`);return}e.port1.off("message",this.onRendererMessage.bind(this)),e.port1.close(),e.port2.close(),this.messagePorts.delete(t)}async onAllWindowsClosed(){this.messagePorts.forEach((t,e)=>{this.shutdownChannel(e)}),this.messagePorts.clear(),this.app?.dispose(),process.platform!=="darwin"&&yt.quit()}configure(t){return this.app=D(t),this}use(t){return this.router.defineRootMiddleware(t),this}start(){return this.app?.onReady(),this}};n(vt,"NoxApp");var $=vt;$=se([w("singleton"),_t("design:type",Function),_t("design:paramtypes",[typeof g>"u"?Object:g])],$);import{app as ce}from"electron/main";async function Gr(o){if(!F(o))throw new Error("Root module must be decorated with @Module");await ce.whenReady();let t=D($);return await t.init(),t}n(Gr,"bootstrapApplication");export{wt as AppInjector,be as Authorize,zt as BadGatewayException,jt as BadRequestException,E as CONTROLLER_METADATA_KEY,Dt as ConflictException,Ve as Controller,Te as Delete,Tt as ForbiddenException,Yt as GatewayTimeoutException,ve as Get,Et as HttpVersionNotSupportedException,Y as INJECTABLE_METADATA_KEY,w as Injectable,Wt as InsufficientStorageException,I as InternalServerException,d as Logger,Kt as LoopDetectedException,$t as MODULE_METADATA_KEY,T as MethodNotAllowedException,Se as Module,Jt as NetworkAuthenticationRequiredException,Ut as NetworkConnectTimeoutException,It as NotAcceptableException,kt as NotExtendedException,C as NotFoundException,Nt as NotImplementedException,$ as NoxApp,Ce as Patch,Ct as PaymentRequiredException,Pe as Post,je as Put,xt as ROUTE_METADATA_KEY,J as Request,Ot as RequestTimeoutException,f as ResponseException,h as RootInjector,g as Router,Ft as ServiceUnavailableException,St as TooManyRequestsException,j as UnauthorizedException,Gt as UpgradeRequiredException,er as UseMiddlewares,Lt as VariantAlsoNegotiatesException,Gr as bootstrapApplication,W as getControllerMetadata,S as getGuardForController,N as getGuardForControllerAction,Ht as getInjectableMetadata,Qt as getMiddlewaresForController,Xt as getMiddlewaresForControllerAction,F as getModuleMetadata,z as getRouteMetadata,D as inject};
/**
 * @copyright 2025 NoxFly
 * @license MIT
 * @author NoxFly
 */
//# sourceMappingURL=noxus.mjs.map